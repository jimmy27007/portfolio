<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="shortcut icon" href="image.png" type="image/x-icon">
<meta charset="UTF-8">
<title>Jimmy AI</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="stylesheet" href="assets/css/style.css">
<link rel="stylesheet" href="assets/css/themes.css">
<link rel="stylesheet" href="assets/css/nav.css">
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
html, body { height: 100%; font-family: 'Inter', sans-serif; background: #e5ddd5; }

.container {
  display: flex;
  flex-direction: column;
  height: 100%;
  max-width: 600px;
  margin: auto;
  background: rgba(255,255,255,0.15);
  backdrop-filter: blur(15px);
  border-left: 1px solid rgba(0,0,0,0.1);
  border-right: 1px solid rgba(0,0,0,0.1);
  position: relative;
}

.header {
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 15px;
  background: #075E54;
  color: #fff;
  font-weight: 600;
  font-size: 18px;
  position: relative;
}

.menu-btn { background: none; border: none; color: #fff; font-size: 24px; cursor: pointer; position: relative; }

.dropdown {
  display: none;
  position: absolute;
  top: 60px;
  right: 10px;
  background: rgba(255,255,255,0.95);
  border-radius: 12px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  min-width: 180px;
  flex-direction: column;
  z-index: 100;
  overflow: hidden;
  transition: all 0.2s ease;
}

.dropdown button {
  padding: 12px 16px;
  border: none;
  background: none;
  text-align: left;
  cursor: pointer;
  width: 100%;
  font-size: 14px;
  transition: background 0.2s;
}

.dropdown button:hover { background: rgba(0,0,0,0.05); }

#chat-area {
  flex: 1;
  padding: 15px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  overflow-y: auto;
}

#chat-area::-webkit-scrollbar { width: 6px; }
#chat-area::-webkit-scrollbar-track { background: transparent; }
#chat-area::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 3px; }

.message {
  max-width: 75%;
  padding: 10px 14px;
  border-radius: 20px;
  font-size: 15px;
  line-height: 1.4;
  word-wrap: break-word;
  position: relative;
  display: inline-block;
  animation: fadeIn 0.25s ease-in-out;
}

.user { background: #dcf8c6; align-self: flex-end; border-bottom-right-radius: 2px; color: #000; }
.assistant { background: #fff; align-self: flex-start; border-bottom-left-radius: 2px; color: #000; backdrop-filter: blur(5px); position: relative; }

.copy-btn {
  position: absolute;
  top: 5px;
  right: 5px;
  font-size: 12px;
  background: #128C7E;
  color: #fff;
  border: none;
  border-radius: 4px;
  padding: 2px 6px;
  cursor: pointer;
  opacity: 0.8;
}
.copy-btn:hover { opacity: 1; }

@keyframes fadeIn { from { opacity: 0; transform: translateY(10px);} to { opacity: 1; transform: translateY(0);} }

.typing { display: inline-block; width: 6px; height: 6px; background: #128C7E; border-radius: 50%; margin-right: 3px; animation: blink 1s infinite alternate; }
.typing:nth-child(2) { animation-delay: 0.2s; }
.typing:nth-child(3) { animation-delay: 0.4s; }
@keyframes blink { from { opacity: 0.2; } to { opacity: 1; } }

.header-dots { display: flex; gap: 3px; margin-left: 10px; }
.header-dots span { width: 6px; height: 6px; background: #fff; border-radius: 50%; animation: blink 1s infinite alternate; }
.header-dots span:nth-child(2) { animation-delay: 0.2s; }
.header-dots span:nth-child(3) { animation-delay: 0.4s; }

.input-container { display: flex; align-items: center; padding: 8px 10px; background: #f0f0f0; border-top: 1px solid rgba(0,0,0,0.1); position: sticky; bottom: 0; gap: 8px; }

#question { flex: 1; padding: 10px 15px; border-radius: 20px; border: 1px solid #ccc; outline: none; font-size: 15px; background: #fff; color: #000; resize: none; }
#question:focus { border-color: #128C7E; }

.send-btn { background: #128C7E; border: none; border-radius: 50%; color: #fff; width: 40px; height: 40px; cursor: pointer; font-size: 18px; display: flex; justify-content: center; align-items: center; }
.send-btn:hover { background: #075E54; }

.toast { position: fixed; top: 80px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); color: #fff; padding: 12px 20px; border-radius: 25px; font-size: 14px; opacity: 0; pointer-events: none; transition: opacity 0.4s, transform 0.4s; z-index: 1000; }
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); pointer-events: auto; }

.suggestions { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 10px; }
.suggestion-btn { padding: 8px 12px; background: #34b7f1; color: #fff; border: none; border-radius: 20px; cursor: pointer; font-size: 14px; transition: background 0.2s; }
.suggestion-btn:hover { background: #128C7E; }

.message table { border-collapse: collapse; width: 100%; margin-top: 5px; }
.message th, .message td { border: 1px solid #999; padding: 5px 10px; text-align: left; }
.message th { background-color: #f0f0f0; }
</style>
</head>
<body>

<div id="header"></div>

<div class="container">
  <div class="header">
    Have a question • Ask me 
    <div style="position: relative; display: flex; align-items: center;">
      <div class="header-dots" id="header-dots" style="display:none;"><span></span><span></span><span></span></div>
      <button class="menu-btn" onclick="toggleMenu()">⋮</button>
      <div class="dropdown" id="dropdown-menu">
        <button onclick="copyLastMessage()">Copy Last Message</button>
        <button onclick="clearChat()">Clear Chat</button>
        <button onclick="toggleDarkMode()">Toggle Dark Mode</button>
        <button onclick="showToast('HTML WhatsApp Chat • Version 1.0')">About</button>
      </div>
    </div>
  </div>

  <div id="chat-area"></div>

  <div class="input-container">
    <textarea id="question" placeholder="Type a message..." rows="1"></textarea>
    <button class="send-btn" onclick="askOpenRouter()">➤</button>
  </div>
</div>

<div id="toast" class="toast"></div>

<script>
const API_KEY = "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"; 
let conversation = JSON.parse(localStorage.getItem('conversation')) || [
  { role: "system", content: `
You are a helpful AI assistant. Respond ONLY in clean HTML suitable for webpage rendering. 
Do NOT include greetings, commentary, disclaimers, or markdown. Only produce HTML with tables, lists, headings, paragraphs, and line breaks.
` }
];
let darkMode = false;

function toggleMenu() {
  const menu = document.getElementById('dropdown-menu');
  menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
  menu.style.flexDirection = 'column';
}

document.addEventListener('click', (e) => {
  const menu = document.getElementById('dropdown-menu');
  const btn = document.querySelector('.menu-btn');
  if (!menu.contains(e.target) && e.target !== btn) menu.style.display = 'none';
});

function showToast(message) {
  const toast = document.getElementById('toast');
  toast.innerText = message;
  toast.classList.add('show');
  setTimeout(() => { toast.classList.remove('show'); }, 2500);
}

function saveConversation() {
  localStorage.setItem('conversation', JSON.stringify(conversation));
}

function appendMessage(content, sender, save=true) {
  const chat = document.getElementById('chat-area');
  const msg = document.createElement('div');
  msg.className = `message ${sender}`;
  msg.innerHTML = content;

  // Add copy button only for AI messages
  if(sender === 'assistant') {
    const copyBtn = document.createElement('button');
    copyBtn.innerText = 'Copy';
    copyBtn.className = 'copy-btn';
    copyBtn.onclick = () => {
      navigator.clipboard.writeText(msg.innerText).then(() => showToast('Message copied'));
    };
    msg.appendChild(copyBtn);
  }

  chat.appendChild(msg);
  chat.scrollTop = chat.scrollHeight;
  if(save) saveConversation();
}

function appendTyping() {
  const chat = document.getElementById('chat-area');
  const typingMsg = document.createElement('div');
  typingMsg.className = 'message assistant';
  typingMsg.id = 'typing';
  typingMsg.innerHTML = `<span class="typing"></span><span class="typing"></span><span class="typing"></span>`;
  chat.appendChild(typingMsg);
  chat.scrollTop = chat.scrollHeight;
  document.getElementById('header-dots').style.display = 'flex';
}

function removeTyping() {
  const typing = document.getElementById('typing');
  if (typing) typing.remove();
  document.getElementById('header-dots').style.display = 'none';
}

async function askOpenRouter(question = null) {
  const input = document.getElementById('question');
  if (!question) question = input.value.trim();
  if (!question) return;
  
  appendMessage(question, 'user');
  appendTyping();
  conversation.push({ role: "user", content: question });
  saveConversation();
  input.value = "";

  try {
    const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
      method: "POST",
      headers: { "Content-Type": "application/json", "Authorization": "Bearer " + API_KEY },
      body: JSON.stringify({ model: "openai/gpt-oss-20b:free", messages: conversation, max_tokens: 5000 })
    });
    const data = await response.json();
    let reply = data?.choices?.[0]?.message?.content || "<p>No response received.</p>";
    reply = reply.replace(/^No disallowed content\. Good\. Ok produce\.\s*/i,'');
    conversation.push({ role: "assistant", content: reply });
    removeTyping();
    appendMessage(reply, 'assistant');
  } catch (err) {
    removeTyping();
    appendMessage("<p>Error: " + err.message + "</p>", 'assistant');
  }
}

/* Settings */
function copyLastMessage() {
  const chat = document.getElementById('chat-area');
  const messages = chat.querySelectorAll('.message');
  if (messages.length === 0) return showToast('No messages to copy');
  const lastMessage = messages[messages.length - 1].innerText;
  navigator.clipboard.writeText(lastMessage).then(() => showToast('Last message copied!'));
}

function clearChat() {
  conversation = [
    { role: "system", content: `
You are a helpful AI assistant. Respond ONLY in clean HTML suitable for webpage rendering.
Do NOT include greetings, commentary, disclaimers, or markdown. Only produce HTML with tables, lists, headings, paragraphs, and line breaks.
` }
  ];
  document.getElementById('chat-area').innerHTML = '';
  localStorage.removeItem('conversation');
  showToast('Chat cleared');
  showSuggestions();
}

function toggleDarkMode() {
  darkMode = !darkMode;
  document.body.style.background = darkMode ? "#121212" : "#e5ddd5";
  document.querySelector('.container').style.background = darkMode ? "rgba(20,20,20,0.15)" : "rgba(255,255,255,0.15)";
  showToast(darkMode ? 'Dark mode enabled' : 'Light mode enabled');
}

/* Enter key to send, Shift+Enter for newline */
const textarea = document.getElementById('question');
textarea.addEventListener('keydown', function(e) {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    askOpenRouter();
  }
});

/* Suggestions */
const suggestionList = [
  "Explain Newton's laws",
  "Show a HTML table example",
  "What is the weather today?",
  "Give me a sample JSON object",
  "Explain machine learning in simple terms",
  "What are the latest tech trends?"
];

function showSuggestions() {
  const chat = document.getElementById('chat-area');
  const container = document.createElement('div');
  container.className = 'suggestions';
  const randomSuggestions = suggestionList.sort(() => 0.5 - Math.random()).slice(0, 4);
  randomSuggestions.forEach(s => {
    const btn = document.createElement('button');
    btn.className = 'suggestion-btn';
    btn.innerText = s;
    btn.onclick = () => askOpenRouter(s);
    container.appendChild(btn);
  });
  chat.appendChild(container);
  chat.scrollTop = chat.scrollHeight;
}

/* Load previous chats */
function loadConversation() {
  const saved = JSON.parse(localStorage.getItem('conversation'));
  if (!saved) return showSuggestions();
  saved.forEach(msg => {
    if(msg.role !== 'system') appendMessage(msg.content, msg.role, false);
  });
  showSuggestions();
}

window.onload = loadConversation;
</script>

<div id="footer"></div>

<script src="assets/js/matrix.js"></script>
<script src="assets/js/main.js"></script>
<script src="assets/js/nav.js"></script>

</body>
</html>
